<?xml version="1.0" encoding="UTF-8"?>
<!--
  ~ MIT License
  ~
  ~ Copyright (c) 2018 Davi Saranszky Mesquita https://github.com/frkr/druuls
  ~
  ~ Permission is hereby granted, free of charge, to any person obtaining a copy
  ~ of this software and associated documentation files (the "Software"), to deal
  ~ in the Software without restriction, including without limitation the rights
  ~ to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
  ~ copies of the Software, and to permit persons to whom the Software is
  ~ furnished to do so, subject to the following conditions:
  ~
  ~ The above copyright notice and this permission notice shall be included in all
  ~ copies or substantial portions of the Software.
  ~
  ~ THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  ~ IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  ~ FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
  ~ AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  ~ LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
  ~ OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
  ~ SOFTWARE.
  -->
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets">
<ui:composition template="/template/template.xhtml">
    <ui:define name="conteudo">

        <h:form prependId="false">

            <p:dialog
                    widgetVar="regraDlg"
                    header="Regra"
                    modal="true"
                    resizable="true"
                    maximizable="true"
                    height="500"
                    width="800"
            >
                <p:outputPanel id="regraPanel">
                    <p:panelGrid layout="grid" columns="2">
                        <p:outputLabel for="lblNovo" value="Editando" rendered="#{ruleView.atual.idGerado ne null}"/>
                        <p:outputLabel for="lblNovo" value="Novo" rendered="#{ruleView.atual.idGerado eq null}"/>
                        <p:commandButton id="lblNovo" value="Salvar" action="#{ruleView.salvar()}" ajax="false"/>

                        <p:outputLabel for="lblid" value="Número da Regra"/>
                        <h:outputText id="lblid" value="#{ruleView.atual.idGerado}"/>
                        <p:outputLabel for="txtNome" value="Título"/>
                        <p:inputText id="txtNome" value="#{ruleView.atual.titulo}"/>
                    </p:panelGrid>

                    <p:panel header="Tipos" toggleable="true" style="margin-bottom:20px;" collapsed="false">
                        <f:facet name="footer">
                            <p:panelGrid columns="2" cellpadding="10">
                                <p:outputLabel value="Usar objeto de saída:"/>
                                <p:selectOneMenu value="#{ruleView.atual.saida}">
                                    <f:selectItems value="#{ruleView.atual.listaTipo}"/>
                                </p:selectOneMenu>
                            </p:panelGrid>
                        </f:facet>
                        <p:dataGrid value="#{ruleView.atual.listaDominio}" var="listaTipo" columns="12" rows="10"
                                    paginator="true"
                                    paginatorAlwaysVisible="true">
                            <p:panel header="#{listaTipo.key}">
                                <table cellpadding="10" cellspacing="0" border="1">
                                    <p:repeat value="#{listaTipo.value}" var="dominio">
                                        <tr>
                                            <td>
                                                <h:outputText value="#{dominio.key}"/>
                                            </td>
                                            <td>
                                                <h:outputText value="#{dominio.value}"/>
                                            </td>
                                        </tr>
                                    </p:repeat>
                                </table>
                            </p:panel>
                        </p:dataGrid>
                    </p:panel>
                    <p:panel header="Regras" toggleable="true" style="margin-bottom:20px;" collapsed="false">
                        <p:dataGrid value="#{ruleView.atual.listaFato}" var="fato" columns="1" rows="1" paginator="true"
                                    paginatorAlwaysVisible="true">
                            <p:panel header="#{fato.key}">
                                <p:panel header="Críticas">
                                    <table cellpadding="10" cellspacing="0" border="1">
                                        <p:repeat value="#{fato.value}" var="critica">
                                            <tr>
                                                <td>
                                                    <h:outputText value="#{critica.key}"/>
                                                </td>
                                                <td>
                                                    <h:outputText value="#{critica.value}"/>
                                                </td>
                                            </tr>
                                        </p:repeat>
                                    </table>
                                </p:panel>
                                <p:panel header="Resultados">
                                    <table cellpadding="10" cellspacing="0" border="1">
                                        <p:repeat value="#{ruleView.atual.listaResultado.get(fato.key)}"
                                                  var="resultado">
                                            <tr>
                                                <td>
                                                    <h:outputText value="#{resultado.key}"/>
                                                </td>
                                                <td>
                                                    <h:outputText value="#{resultado.value}"/>
                                                </td>
                                            </tr>
                                        </p:repeat>
                                    </table>
                                </p:panel>
                            </p:panel>
                        </p:dataGrid>
                    </p:panel>
                </p:outputPanel>
            </p:dialog>
            <p:dataTable
                    rows="100"
                    paginator="true"
                    paginatorAlwaysVisible="true"
                    rowsPerPageTemplate="25,50,100"
                    value="#{ruleView.tudo()}"
                    var="rule"
            >
                <f:facet name="header">
                    Regras
                    <p:commandButton
                            update="regraPanel"
                            oncomplete="PF('regraDlg').show()"
                            icon="ui-icon-plus"
                            title="Novo"
                            action="#{ruleView.setAtual(null)}"
                    />
                </f:facet>
                <p:column style="width:32px;text-align: center">
                    <p:commandButton
                            update="regraPanel"
                            oncomplete="PF('regraDlg').show()"
                            icon="ui-icon-pencil"
                            title="Editar"
                            action="#{ruleView.carregar(rule.id)}"/>
                    <!--<f:setPropertyActionListener value="#{rule.id}" target="#{ruleView.atual.idGerado}"/>-->
                </p:column>

                <p:column headerText="Título">
                    <h:outputText value="#{rule.titulo}"/>
                </p:column>
            </p:dataTable>

            <p:panel header="Debug" toggleable="true" collapsed="true">
                <p:panel header="Mensagens de Erro">
                    <p:inputTextarea id="kieErros" cols="100" rows="5" value="#{ruleView.atual.erros}"/>
                </p:panel>
                <p:panel header="DRL">
                    <p:inputTextarea id="codigoFonte" cols="100" rows="30" value="#{ruleView.atual.drl}"/>
                </p:panel>
            </p:panel>

        </h:form>
    </ui:define>
</ui:composition>
</html>
